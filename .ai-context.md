# AI 協作上下文 Context for AI

> 本文檔專為 AI 助手設計，提供專案快速理解的關鍵資訊

## 🎯 專案本質

**一句話描述**: 改良的迭代式 DFS + 隨機回溯演算法實作的迷宮生成器（支援種子碼重現），有網頁版和 C 語言命令列版

**重要特性**: 解決傳統遞迴回溯的長走廊問題，產生更多自然分岔但保持單一解法

## 📂 關鍵檔案

| 檔案 | 用途 | 修改頻率 |
|------|------|----------|
| `maze.c` | C 語言核心邏輯 + 種子系統 + SVG 輸出 | 中 |
| `maze.js` | JavaScript 迷宮生成 + 種子系統 | 中 |
| `index.html` | 網頁 UI（含種子碼輸入、列印按鈕） | 低 |
| `style.css` | 視覺樣式（含列印專用樣式） | 中 |
| `README.md` | 使用說明文檔 | 低 |
| `docs/TECHNICAL.md` | 技術細節文檔 | 低 |

## ⚡ 快速理解

### 核心邏輯位置
- **迭代式 DFS**: `generate_maze()` (C) / `generate()` (JS)
- **種子隨機數**: `RandomGenerator` (C) / `SeededRandom` (JS)
- **初始化**: `create_maze()` (C) / `constructor()` (JS)
- **渲染**: `export_svg()` (C) / `renderMaze()` (JS)

### 演算法關鍵
```c
// 30% 機率跳回較早的棧位置（創造分岔）
if (stack_size > 10 && random_range(100) < 30) {
    stack_pos = random_range(stack_size);
} else {
    stack_pos = stack_size - 1;  // 正常 DFS
}
```

### 資料編碼
```
0 = 路徑 (白色)
1 = 牆壁 (深灰/黑)
2 = 起點 (綠色)
3 = 終點 (紅色)
```

### 關鍵約束
- ⚠️ **寬高必須為奇數** - 這是演算法的數學要求
- ⚠️ **C 和 JS 邏輯必須同步** - 保持一致性，特別是種子系統
- ⚠️ **種子系統使用 LCG** - 確保跨平台一致，不可使用系統 rand()
- ⚠️ **起點固定 (1,1)，終點固定 (height-2, width-2)** - 對角線位置
- ⚠️ **30% 隨機回溯機率** - 這是平衡複雜度的關鍵參數

### 種子系統
```
LCG 公式: seed = (seed * 1103515245 + 12345) & 0x7fffffff
用途: 相同種子 + 相同尺寸 = 相同迷宮（跨平台）
```

## 🔍 常見任務指南

### 修改迷宮顏色
```
→ 網頁版: 編輯 style.css 的 CSS 變數
→ C 版本: 搜尋 maze.c 中的 fill=
```

### 調整尺寸限制
```
→ 網頁版: index.html 的 <input min= max=>
→ C 版本: maze.c 的 #define MAX_SIZE
```

### 調整複雜度
```
→ 修改隨機回溯機率（目前 30%）
→ C: if (stack_size > 10 && random_range(100) < 30)
→ JS: if (stack.length > 10 && this.rng.nextInt(100) < 30)
→ 提高機率 = 更多分岔，降低機率 = 更長走廊
```

### 使用種子碼
```
→ 網頁版: 在種子碼欄位輸入數字
→ C 版本: ./maze [width] [height] [seed] [filename]
→ 範例: ./maze 31 31 12345 test.svg
```

### 列印功能
```
→ 網頁版: 點擊「🖨️ 列印」按鈕或 Ctrl+P
→ C 版本: 開啟生成的 HTML 檔案，點擊列印按鈕
```

### 更改演算法
```
→ 同時修改: generate_maze() (C) 和 generate() (JS)
→ 重要: 修改後測試相同種子是否產生相同迷宮
→ 測試: ./maze 31 31 12345 && ./maze 31 31 12345 test2.svg && diff *.svg
```

## 🧪 測試流程

### C 語言版
```bash
make clean && make         # 編譯
./maze 31 31 12345        # 執行測試（使用種子 12345）
./maze 31 31 12345 test2.svg  # 再次生成驗證一致性
diff maze.svg test2.svg   # 應該相同
xdg-open maze.html        # 檢視結果
```

### 網頁版
```bash
xdg-open index.html       # 直接開啟
# 測試種子: 輸入 12345 多次生成，應產生相同迷宮
# 測試列印: 點擊「🖨️ 列印」按鈕，檢查列印預覽
```

### 驗證清單
- [ ] 迷宮可生成且每次不同（無種子時）
- [ ] 相同種子產生相同迷宮（C 和 JS 都要測試）
- [ ] 起點和終點正確標記
- [ ] 從起點可到達終點
- [ ] 無孤立區域
- [ ] 有明顯的分岔路徑（不是長走廊）
- [ ] 視覺呈現正確
- [ ] 種子碼顯示在 HTML 輸出中
- [ ] 列印功能正常（隱藏控制項）

## 🚫 不要做的事

1. **不要改為偶數寬高** - 演算法會失敗
2. **不要使用系統 rand()/Math.random()** - 會破壞種子重現功能
3. **不要修改 LCG 公式** - 會破壞跨平台一致性
4. **不要改變格子間距邏輯** (步長為 2) - 會破壞迷宮結構
5. **不要引入外部依賴** - 保持純 C 和 Vanilla JS
6. **不要破壞 A4 列印適配** - C 版的輸出尺寸經過精確計算
7. **不要移除列印樣式** - @media print 很重要

## 💡 設計哲學

- **簡潔性**: 無外部依賴，易於理解和維護
- **雙重實作**: C 用於高品質列印，JS 用於即時互動
- **可重現性**: 種子系統讓迷宮可分享和挑戰
- **單一解法**: 保持挑戰性，但增加分岔決策點
- **跨平台**: C 和 JS 使用相同種子產生相同迷宮
- **適合列印**: 網頁版和 C 版都有列印優化

## 🔄 版本同步檢查

修改後確認以下一致性:

| 特性 | C 版本 | JS 版本 |
|------|--------|---------|
| 演算法邏輯 | generate_maze() | generate() |
| 種子系統 | RandomGenerator (LCG) | SeededRandom (LCG) |
| 初始化全為牆 | ✓ | ✓ |
| 起點 (1,1) | ✓ | ✓ |
| 終點對角 | ✓ | ✓ |
| 迭代式 DFS | ✓ | ✓ |
| 30% 隨機回溯 | ✓ | ✓ |
| 相同種子相同結果 | ✓ | ✓ |
| 列印功能 | HTML 輸出 | window.print() |

## 📋 命令速查

```bash
# 編譯
make

# 執行（自動種子）
./maze

# 執行（固定種子）
./maze 31 31 12345

# 自訂尺寸和種子
./maze 41 51 67890 custom.svg

# 驗證種子一致性
./maze 31 31 12345 test1.svg
./maze 31 31 12345 test2.svg
diff test1.svg test2.svg  # 應該相同

# 清理
make clean

# 快速測試流程
make clean && make && ./maze 31 31 12345 && xdg-open maze.html
```

## 🎨 主題色系

```
主要漸層: #667eea → #764ba2 (紫色系)
牆壁: #333 (深灰) / black (黑色)
路徑: #ffffff (白色)
起點: #4CAF50 (綠色)
終點: #f44336 (紅色)
種子顯示: #667eea (紫色) on #f0f0f0 (淺灰背景)
```

## 📝 程式碼風格偏好

- **中文註解**: 保持現有中文註解
- **簡短函式**: 單一職責，易於理解
- **描述性命名**: 變數和函式名稱清楚表達意圖
- **最小依賴**: 避免外部庫
- **種子一致**: 跨平台使用相同 LCG 公式

## 🆕 版本 2.0 重點變更

1. **演算法**: 傳統遞迴回溯 → 改良的迭代式 DFS + 隨機回溯
2. **複雜度**: 解決長走廊問題，產生更多自然分岔
3. **種子系統**: 新增完整的種子碼支援（跨平台一致）
4. **UI 更新**: 網頁版加入種子碼輸入框和列印按鈕
5. **列印優化**: CSS @media print 樣式
6. **HTML 輸出**: 顯示種子碼資訊
7. **命令參數**: `./maze [width] [height] [seed] [filename]`

---

**使用建議**: AI 在開始任務前先閱讀此文檔，可快速掌握專案脈絡，減少探索時間。特別注意種子系統和隨機回溯機制的實作細節。

## 📂 關鍵檔案

| 檔案 | 用途 | 修改頻率 |
|------|------|----------|
| `maze.c` | C 語言核心邏輯 + 種子系統 + SVG 輸出 | 中 |
| `maze.js` | JavaScript 迷宮生成 + 種子系統 | 中 |
| `index.html` | 網頁 UI（含種子碼輸入） | 低 |
| `style.css` | 視覺樣式 | 中 |
| `README.md` | 使用說明文檔 | 低 |
| `docs/TECHNICAL.md` | 技術細節文檔 | 低 |

## ⚡ 快速理解

### 核心邏輯位置
- **Prim's 演算法**: `generate_maze()` (C) / `generate()` (JS)
- **種子隨機數**: `RandomGenerator` (C) / `SeededRandom` (JS)
- **初始化**: `create_maze()` (C) / `constructor()` (JS)
- **渲染**: `export_svg()` (C) / `renderMaze()` (JS)

### 資料編碼
```
0 = 路徑 (白色)
1 = 牆壁 (深灰/黑)
2 = 起點 (綠色)
3 = 終點 (紅色)
```

### 關鍵約束
- ⚠️ **寬高必須為奇數** - 這是演算法的數學要求
- ⚠️ **C 和 JS 邏輯必須同步** - 保持一致性，特別是種子系統
- ⚠️ **種子系統使用 LCG** - 確保跨平台一致，不可使用系統 rand()
- ⚠️ **起點固定 (1,1)，終點固定 (height-2, width-2)** - 對角線位置

### 種子系統
```
LCG 公式: seed = (seed * 1103515245 + 12345) & 0x7fffffff
用途: 相同種子 + 相同尺寸 = 相同迷宮（跨平台）
```

## 🔍 常見任務指南

### 修改迷宮顏色
```
→ 網頁版: 編輯 style.css 的 CSS 變數
→ C 版本: 搜尋 maze.c 中的 fill=
```

### 調整尺寸限制
```
→ 網頁版: index.html 的 <input min= max=>
→ C 版本: maze.c 的 #define MAX_SIZE 和 MAX_FRONTIER
```

### 使用種子碼
```
→ 網頁版: 在種子碼欄位輸入數字
→ C 版本: ./maze [width] [height] [seed] [filename]
→ 範例: ./maze 31 31 12345 test.svg
```

### 更改演算法
```
→ 同時修改: generate_maze() (C) 和 generate() (JS)
→ 重要: 修改後測試相同種子是否產生相同迷宮
→ 測試: ./maze 31 31 12345 && ./maze 31 31 12345 test2.svg && diff *.svg
```

### 新增功能
```
→ 僅網頁: 修改 maze.js 和 index.html
→ 僅命令列: 修改 maze.c
→ 雙版本: 評估是否需要同步實作（特別是核心演算法）
```

## 🧪 測試流程

### C 語言版
```bash
make clean && make         # 編譯
./maze 31 31 12345        # 執行測試（使用種子 12345）
./maze 31 31 12345 test2.svg  # 再次生成驗證一致性
diff maze.svg test2.svg   # 應該相同
xdg-open maze.html        # 檢視結果
```

### 網頁版
```bash
xdg-open index.html       # 直接開啟
# 測試種子: 輸入 12345 多次生成，應產生相同迷宮
```

### 驗證清單
- [ ] 迷宮可生成且每次不同（無種子時）
- [ ] 相同種子產生相同迷宮（C 和 JS 都要測試）
- [ ] 起點和終點正確標記
- [ ] 從起點可到達終點
- [ ] 無孤立區域
- [ ] 視覺呈現正確
- [ ] 種子碼顯示在 HTML 輸出中

## 🚫 不要做的事

1. **不要改為偶數寬高** - 演算法會失敗
2. **不要使用系統 rand()/Math.random()** - 會破壞種子重現功能
3. **不要修改 LCG 公式** - 會破壞跨平台一致性
4. **不要改變格子間距邏輯** (步長為 2) - 會破壞迷宮結構
5. **不要引入外部依賴** - 保持純 C 和 Vanilla JS
6. **不要破壞 A4 列印適配** - C 版的輸出尺寸經過精確計算

## 💡 設計哲學

- **簡潔性**: 無外部依賴，易於理解和維護
- **雙重實作**: C 用於高品質列印，JS 用於即時互動
- **可重現性**: 種子系統讓迷宮可分享和挑戰
- **單一解法**: 保持挑戰性，但增加分岔決策點
- **跨平台**: C 和 JS 使用相同種子產生相同迷宮

## 🔄 版本同步檢查

修改後確認以下一致性:

| 特性 | C 版本 | JS 版本 |
|------|--------|---------|
| 演算法邏輯 | generate_maze() | generate() |
| 種子系統 | RandomGenerator (LCG) | SeededRandom (LCG) |
| 初始化全為牆 | ✓ | ✓ |
| 起點 (1,1) | ✓ | ✓ |
| 終點對角 | ✓ | ✓ |
| Frontier 隨機選擇 | ✓ | ✓ |
| 相同種子相同結果 | ✓ | ✓ |

## 📋 命令速查

```bash
# 編譯
make

# 執行（自動種子）
./maze

# 執行（固定種子）
./maze 31 31 12345

# 自訂尺寸和種子
./maze 41 51 67890 custom.svg

# 驗證種子一致性
./maze 31 31 12345 test1.svg
./maze 31 31 12345 test2.svg
diff test1.svg test2.svg  # 應該相同

# 清理
make clean

# 快速測試流程
make clean && make && ./maze 31 31 12345 && xdg-open maze.html
```

## 🎨 主題色系

```
主要漸層: #667eea → #764ba2 (紫色系)
牆壁: #333 (深灰) / black (黑色)
路徑: #ffffff (白色)
起點: #4CAF50 (綠色)
終點: #f44336 (紅色)
種子顯示: #667eea (紫色) on #f0f0f0 (淺灰背景)
```

## 📝 程式碼風格偏好

- **中文註解**: 保持現有中文註解
- **簡短函式**: 單一職責，易於理解
- **描述性命名**: 變數和函式名稱清楚表達意圖
- **最小依賴**: 避免外部庫
- **種子一致**: 跨平台使用相同 LCG 公式

## 🆕 版本 2.0 重點變更

1. **演算法**: 遞迴回溯 → Prim's（更多分岔但保持單一解）
2. **種子系統**: 新增完整的種子碼支援（跨平台一致）
3. **UI 更新**: 網頁版加入種子碼輸入框
4. **HTML 輸出**: 顯示種子碼資訊
5. **命令參數**: `./maze [width] [height] [seed] [filename]`

---

**使用建議**: AI 在開始任務前先閱讀此文檔，可快速掌握專案脈絡，減少探索時間。特別注意種子系統的實作細節。

## 🔍 常見任務指南

### 修改迷宮顏色
```
→ 網頁版: 編輯 style.css 的 CSS 變數
→ C 版本: 搜尋 maze.c 中的 stroke= 和 fill=
```

### 調整尺寸限制
```
→ 網頁版: index.html 的 <input min= max=>
→ C 版本: maze.c 的 #define MAX_SIZE
```

### 更改演算法
```
→ 同時修改: carve_passages() (C) 和 carvePassages() (JS)
→ 測試: make && ./maze 以及在瀏覽器測試
```

### 新增功能
```
→ 僅網頁: 修改 maze.js 和 index.html
→ 僅命令列: 修改 maze.c
→ 雙版本: 評估是否需要同步實作
```

## 🧪 測試流程

### C 語言版
```bash
make clean && make         # 編譯
./maze 21 31              # 執行測試
xdg-open maze.html        # 檢視結果
```

### 網頁版
```bash
xdg-open index.html       # 直接開啟
# 或使用 Python 簡易伺服器
python3 -m http.server 8000
```

### 驗證清單
- [ ] 迷宮可生成且每次不同
- [ ] 起點和終點正確標記
- [ ] 從起點可到達終點
- [ ] 無孤立區域
- [ ] 視覺呈現正確

## 🚫 不要做的事

1. **不要改為偶數寬高** - 演算法會失敗
2. **不要移除 shuffle 隨機化** - 會導致迷宮太規律
3. **不要改變格子間距邏輯** (dx, dy 步長為 2) - 會破壞迷宮結構
4. **不要引入外部依賴** - 保持純 C 和 Vanilla JS
5. **不要破壞 A4 列印適配** - C 版的輸出尺寸經過精確計算

## 💡 設計哲學

- **簡潔性**: 無外部依賴，易於理解和維護
- **雙重實作**: C 用於高品質列印，JS 用於即時互動
- **教育性**: 程式碼清晰展示遞迴回溯演算法
- **實用性**: 真實可用（列印、遊玩）而非玩具專案

## 🔄 版本同步檢查

修改後確認以下一致性:

| 特性 | C 版本 | JS 版本 |
|------|--------|---------|
| 演算法邏輯 | carve_passages() | carvePassages() |
| 初始化全為牆 | ✓ | ✓ |
| 起點 (1,1) | ✓ | ✓ |
| 終點對角 | ✓ | ✓ |
| 四方向探索 | ✓ | ✓ |
| 隨機打亂方向 | ✓ | ✓ |

## 📋 命令速查

```bash
# 編譯
make

# 執行預設尺寸
./maze

# 自訂尺寸（寬 高）
./maze 41 51

# 清理
make clean

# 快速測試流程
make clean && make && ./maze 21 31 && xdg-open maze.html
```

## 🎨 主題色系

```
主要漸層: #667eea → #764ba2 (紫色系)
牆壁: #2d3748 (深灰)
路徑: #ffffff (白色)
起點: #48bb78 (綠色)
終點: #f56565 (紅色)
```

## 📝 程式碼風格偏好

- **中文註解**: 保持現有中文註解
- **簡短函式**: 單一職責，易於理解
- **描述性命名**: 變數和函式名稱清楚表達意圖
- **最小依賴**: 避免外部庫

---

**使用建議**: AI 在開始任務前先閱讀此文檔，可快速掌握專案脈絡，減少探索時間。
